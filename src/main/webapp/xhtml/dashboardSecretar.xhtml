<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets">

<ui:composition template="/WEB-INF/Templates/layout.xhtml">

    <ui:define name="title">Dashboard Secretar</ui:define>

    <ui:define name="content">
        <p:growl id="growl" showDetail="true"/>

        <h:form id="mainForm">

            <p:panel id="organizatiePanel" header="Detalii Organizație - #{dashboardSecretarBean.currentOrganizatie.nume}">
                <p:panelGrid columns="2" styleClass="ui-noborder" rendered="#{!dashboardSecretarBean.editModeOrganizatie}">
                    <h:outputText value="Nume:" style="font-weight: bold;"/>
                    <h:outputText value="#{dashboardSecretarBean.currentOrganizatie.nume}"/>

                    <h:outputText value="Adresă:" style="font-weight: bold;"/>
                    <h:outputText value="#{dashboardSecretarBean.currentOrganizatie.adresa}"/>

                    <h:outputText value="Email:" style="font-weight: bold;"/>
                    <h:outputText value="#{dashboardSecretarBean.currentOrganizatie.mail}"/>

                    <h:outputText value="CIF:" style="font-weight: bold;"/>
                    <h:outputText value="#{dashboardSecretarBean.currentOrganizatie.cif}"/>
                </p:panelGrid>

                <p:panelGrid columns="2" styleClass="ui-noborder" rendered="#{dashboardSecretarBean.editModeOrganizatie}">
                    <p:outputLabel for="numeOrg" value="Nume:"/>
                    <p:inputText id="numeOrg" value="#{dashboardSecretarBean.currentOrganizatie.nume}" required="true" style="width: 100%;"/>

                    <p:outputLabel for="adresaOrg" value="Adresă:"/>
                    <p:inputText id="adresaOrg" value="#{dashboardSecretarBean.currentOrganizatie.adresa}" required="true" style="width: 100%;"/>

                    <p:outputLabel for="emailOrg" value="Email:"/>
                    <p:inputText id="emailOrg" value="#{dashboardSecretarBean.currentOrganizatie.mail}" required="true" style="width: 100%;"/>

                    <p:outputLabel for="cifOrg" value="CIF:"/>
                    <p:inputText id="cifOrg" value="#{dashboardSecretarBean.currentOrganizatie.cif}" readonly="true" style="width: 100%;"/>
                </p:panelGrid>

                <f:facet name="footer">
                    <p:commandButton value="Editează" icon="pi pi-pencil"
                                     actionListener="#{dashboardSecretarBean.activeazaModEditareOrganizatie}"
                                     update="organizatiePanel" rendered="#{!dashboardSecretarBean.editModeOrganizatie}"/>
                    <p:commandButton value="Salvează" icon="pi pi-check"
                                     actionListener="#{dashboardSecretarBean.salveazaDetaliiOrganizatie}"
                                     update="organizatiePanel :growl" rendered="#{dashboardSecretarBean.editModeOrganizatie}"/>
                    <p:commandButton value="Anulează" icon="pi pi-times"
                                     actionListener="#{dashboardSecretarBean.anuleazaEditareOrganizatie}"
                                     update="organizatiePanel" rendered="#{dashboardSecretarBean.editModeOrganizatie}"
                                     styleClass="ui-button-secondary" process="@this"/>
                </f:facet>
            </p:panel>

            <p:panel header="Management General" style="margin-top:20px;">
                <p:commandButton value="Creează Departament Nou" icon="pi pi-plus"
                                 oncomplete="PF('manageDepartmentDialog').show()"
                                 actionListener="#{dashboardSecretarBean.deschideDialogDepartamentNou}"
                                 update=":departmentForm"/>
                <p:commandButton value="Înregistrează Prezență Ședință" icon="pi pi-calendar-plus"
                                 oncomplete="PF('attendanceDialog').show()"
                                 actionListener="#{dashboardSecretarBean.deschideDialogPrezentaNoua}"
                                 update=":attendanceForm" styleClass="ui-button-success" style="margin-left: 10px;"/>

                <p:dataTable id="departamenteTable" var="dept" value="#{dashboardSecretarBean.departmentList}"
                             style="margin-top:20px;" emptyMessage="Nu există departamente create."
                             rows="5" paginator="true" paginatorPosition="bottom">
                    <p:column headerText="Nume Departament">
                        <h:outputText value="#{dept.nume}"/>
                    </p:column>
                    <p:column headerText="Coordonator">
                        <h:outputText value="#{dept.coordonator.numeComplet}" default="N/A"/>
                    </p:column>
                    <p:column headerText="Nr. Membri">
                        <h:outputText value="#{dept.voluntari.size()}"/>
                    </p:column>
                    <p:column headerText="Acțiuni" style="width:10rem; text-align: center">
                        <p:commandButton icon="pi pi-users" title="Vezi Membri"
                                         oncomplete="PF('membersDialog').show()"
                                         update=":membersForm"
                                         actionListener="#{dashboardSecretarBean.vizualizeazaMembriDepartament(dept)}"/>
                        <p:commandButton icon="pi pi-pencil" title="Editează" style="margin-left: 5px"
                                         oncomplete="PF('manageDepartmentDialog').show()" update=":departmentForm"
                                         actionListener="#{dashboardSecretarBean.setSelectedDepartament(dept)}"/>
                        <p:commandButton icon="pi pi-trash" title="Șterge" style="margin-left: 5px"
                                         actionListener="#{dashboardSecretarBean.stergeDepartament(dept)}"
                                         update="departamenteTable :growl" styleClass="ui-button-danger">
                            <p:confirm header="Confirmare" message="Ești sigur că vrei să ștergi departamentul?" icon="pi pi-exclamation-triangle"/>
                        </p:commandButton>
                    </p:column>
                </p:dataTable>
            </p:panel>

            <p:panel header="Management Voluntari" style="margin-top: 20px;">
                <p:tabView>
                    <p:tab title="Nerepartizați (#{dashboardSecretarBean.voluntariNerepartizati.size()})">
                        <ui:include src="/WEB-INF/templates/parts/tabel_voluntari.xhtml">
                            <ui:param name="listaVoluntari" value="#{dashboardSecretarBean.voluntariNerepartizati}"/>
                            <ui:param name="idTabel" value="tabelNerepartizati"/>
                        </ui:include>
                    </p:tab>
                    <p:tab title="Activi &amp; Colaboratori (#{dashboardSecretarBean.voluntariActivi.size() + dashboardSecretarBean.voluntariColaboratori.size()})">
                        <p:panel header="Voluntari Activi">
                            <ui:include src="/WEB-INF/templates/parts/tabel_voluntari.xhtml">
                                <ui:param name="listaVoluntari" value="#{dashboardSecretarBean.voluntariActivi}"/>
                                <ui:param name="idTabel" value="tabelActivi"/>
                            </ui:include>
                        </p:panel>
                        <p:panel header="Voluntari Colaboratori" style="margin-top:10px;">
                            <ui:include src="/WEB-INF/templates/parts/tabel_voluntari.xhtml">
                                <ui:param name="listaVoluntari" value="#{dashboardSecretarBean.voluntariColaboratori}"/>
                                <ui:param name="idTabel" value="tabelColaboratori"/>
                            </ui:include>
                        </p:panel>
                    </p:tab>
                    <p:tab title="Coordonatori (#{dashboardSecretarBean.coordonatori.size()})">
                        <ui:include src="/WEB-INF/templates/parts/tabel_voluntari.xhtml">
                            <ui:param name="listaVoluntari" value="#{dashboardSecretarBean.coordonatori}"/>
                            <ui:param name="idTabel" value="tabelCoordonatori"/>
                        </ui:include>
                    </p:tab>
                    <p:tab title="Inactivi (#{dashboardSecretarBean.voluntariInactivi.size()})">
                        <ui:include src="/WEB-INF/templates/parts/tabel_voluntari.xhtml">
                            <ui:param name="listaVoluntari" value="#{dashboardSecretarBean.voluntariInactivi}"/>
                            <ui:param name="idTabel" value="tabelInactivi"/>
                        </ui:include>
                    </p:tab>
                </p:tabView>
            </p:panel>
        </h:form>

        <h:form id="departmentForm">
            <p:dialog header="Management Departament" widgetVar="manageDepartmentDialog" modal="true" width="500">
                <p:panelGrid columns="2" style="width: 100%;" styleClass="ui-noborder">
                    <p:outputLabel for="numeDept" value="Nume:"/>
                    <p:inputText id="numeDept" value="#{dashboardSecretarBean.selectedDepartament.nume}" required="true" style="width: 100%;"/>

                    <p:outputLabel for="descriereDept" value="Descriere:"/>
                    <p:inputTextarea id="descriereDept" value="#{dashboardSecretarBean.selectedDepartament.descriere}" rows="3" style="width: 100%;"/>

                    <p:outputLabel for="coordDept" value="Coordonator:"/>
                    <p:selectOneMenu id="coordDept" value="#{dashboardSecretarBean.selectedDepartament.coordonator}" converter="omnifaces.SelectItemsConverter">
                        <f:selectItem itemLabel="-- Selectează Coordonator --" itemValue="#{null}"/>
                        <f:selectItems value="#{dashboardSecretarBean.voluntariCoordonatori}" var="coord"
                                       itemLabel="#{coord.numeComplet}" itemValue="#{coord}"/>
                    </p:selectOneMenu>
                </p:panelGrid>
                <f:facet name="footer">
                    <p:commandButton value="Salvează" actionListener="#{dashboardSecretarBean.salveazaDepartament}"
                                     update=":mainForm:departamenteTable :growl" oncomplete="PF('manageDepartmentDialog').hide()"/>
                </f:facet>
            </p:dialog>
        </h:form>

        <h:form id="attendanceForm">
            <p:dialog header="Înregistrare Prezență Ședință" widgetVar="attendanceDialog" modal="true" width="700"
                      resizable="false">
                <p:panelGrid columns="2" style="width: 100%; margin-bottom: 20px;" styleClass="ui-noborder">
                    <p:outputLabel for="denumireSedinta" value="Denumire/Scop:" />
                    <p:inputText id="denumireSedinta" value="#{dashboardSecretarBean.newSedinta.descriere}"
                                 required="true" requiredMessage="Denumirea este obligatorie." style="width: 100%;"/>
                </p:panelGrid>

                <p:dataTable var="voluntar" value="#{dashboardSecretarBean.voluntariActiviPentruPontaj}"
                             rows="10" paginator="true" paginatorPosition="bottom"
                             emptyMessage="Nu există voluntari activi.">
                    <p:column headerText="Voluntar">
                        <h:outputText value="#{voluntar.numeComplet}" />
                    </p:column>
                    <p:column headerText="Status Prezență" style="width: 150px;">
                        <p:selectOneMenu value="#{dashboardSecretarBean.prezenteMap[voluntar.id]}">
                            <f:selectItems value="#{dashboardSecretarBean.statusPrezentaValues}" var="status"
                                           itemLabel="#{status.name()}" itemValue="#{status}"/>
                        </p:selectOneMenu>
                    </p:column>
                </p:dataTable>

                <f:facet name="footer">
                    <p:commandButton value="Salvează Prezența" actionListener="#{dashboardSecretarBean.salveazaPrezenta}"
                                     update=":mainForm :growl"/>
                </f:facet>
            </p:dialog>
        </h:form>

        <h:form id="membersForm">
            <p:dialog header="Membri Departament - #{dashboardSecretarBean.selectedDepartament.nume}"
                      widgetVar="membersDialog" modal="true" width="800">

                <p:commandButton value="Exportă Listă PDF" icon="pi pi-file-pdf"
                                 actionListener="#{dashboardSecretarBean.exportaListaMembriDepartament}"
                                 ajax="false" styleClass="ui-button-help"
                                 rendered="#{not empty dashboardSecretarBean.membriDepartamentCurent}">
                    <p:fileDownload value="#{dashboardSecretarBean.fisierExportat}" />
                </p:commandButton>

                <p:dataTable var="membru" value="#{dashboardSecretarBean.membriDepartamentCurent}" style="margin-top: 15px;"
                             emptyMessage="Acest departament nu are membri.">
                    <p:column headerText="Nume"><h:outputText value="#{membru.numeComplet}"/></p:column>
                    <p:column headerText="Email"><h:outputText value="#{membru.user.email}"/></p:column>
                    <p:column headerText="Status"><h:outputText value="#{membru.status}"/></p:column>
                    <p:column headerText="Acțiuni">
                        <p:commandButton icon="pi pi-sign-out" title="Scoate din departament"
                                         actionListener="#{dashboardSecretarBean.scoateVoluntarDinDepartament(membru)}"
                                         update="membersForm :mainForm :growl" styleClass="ui-button-warning">
                            <p:confirm header="Confirmare" message="Ești sigur că vrei să scoți voluntarul din departament?" icon="pi pi-exclamation-triangle"/>
                        </p:commandButton>
                    </p:column>
                </p:dataTable>
            </p:dialog>
        </h:form>

        <p:confirmDialog global="true">
            <p:commandButton value="Da" type="button" styleClass="ui-confirmdialog-yes" icon="pi pi-check"/>
            <p:commandButton value="Nu" type="button" styleClass="ui-confirmdialog-no ui-button-secondary" icon="pi pi-times"/>
        </p:confirmDialog>
    </ui:define>

</ui:composition>
</html>