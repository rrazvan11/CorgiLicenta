<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui">

<h:head>
    <title>Dashboard Secretar</title>
    <h:outputStylesheet library="default" name="style.css"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
</h:head>

<h:body>
    <div id="page-container">
        <p:growl id="growl" showDetail="true" life="5000" skipDetailIfEqualsSummary="true"/>

        <div id="top-bar">
            <div class="app-title">
                <i class="pi pi-briefcase" style="font-size: 1.5rem; margin-right: 10px;"></i>
                Dashboard Secretar
            </div>
            <div class="user-status">
                <h:form>
                    <span>Bun venit, #{dashboardSecretarBean.loggedInUser.username}!</span>
                    <p:commandButton value="Delogare" action="#{loginBean.doLogout}" icon="pi pi-sign-out" styleClass="ui-button-warning"/>
                </h:form>
            </div>
        </div>

        <div id="content">
            <h:form id="orgForm">
                <p:panel id="panelOrganizatie" header="Datele Organizației" toggleable="true">
                    <p:outputPanel id="organizatieOutputPanel">
                        <p:outputPanel rendered="#{!dashboardSecretarBean.editModeOrganizatie}">
                            <p:panelGrid columns="2" layout="grid" styleClass="ui-panelgrid-blank">
                                <h:outputText value="Nume Organizație:"/><h:outputText value="#{dashboardSecretarBean.currentOrganizatie.nume}" style="font-weight:bold;"/>
                                <h:outputText value="Cod Fiscal:"/><h:outputText value="#{dashboardSecretarBean.currentOrganizatie.cif}" style="font-weight:bold;"/>
                                <h:outputText value="Email Contact:"/><h:outputText value="#{dashboardSecretarBean.currentOrganizatie.mail}" style="font-weight:bold;"/>
                                <h:outputText value="Adresă Sediu:"/><h:outputText value="#{dashboardSecretarBean.currentOrganizatie.adresa}" style="font-weight:bold;"/>
                            </p:panelGrid>
                            <div class="mt-3">
                                <p:commandButton value="Editează Datele" icon="pi pi-pencil"
                                                 actionListener="#{dashboardSecretarBean.activeazaModEditareOrganizatie}"
                                                 update=":orgForm:organizatieOutputPanel"/>
                            </div>
                        </p:outputPanel>

                        <p:outputPanel rendered="#{dashboardSecretarBean.editModeOrganizatie}">
                            <p:panelGrid columns="2" layout="grid" styleClass="ui-panelgrid-blank ui-fluid">
                                <p:outputLabel for="orgName" value="Nume Organizație:"/><p:inputText id="orgName" value="#{dashboardSecretarBean.currentOrganizatie.nume}" required="true"/>
                                <p:outputLabel for="orgCif" value="Cod Fiscal:"/><p:inputText id="orgCif" value="#{dashboardSecretarBean.currentOrganizatie.cif}" required="true"/>
                                <p:outputLabel for="orgMail" value="Email Contact:"/><p:inputText id="orgMail" value="#{dashboardSecretarBean.currentOrganizatie.mail}" required="true"/>
                                <p:outputLabel for="orgAddress" value="Adresă Sediu:"/><p:inputText id="orgAddress" value="#{dashboardSecretarBean.currentOrganizatie.adresa}" required="true"/>
                            </p:panelGrid>
                            <div class="mt-3">
                                <p:commandButton value="Salvează Modificări" icon="pi pi-save"
                                                 actionListener="#{dashboardSecretarBean.salveazaDetaliiOrganizatie}"
                                                 update=":orgForm:organizatieOutputPanel :growl"/>
                                <p:commandButton value="Anulează" icon="pi pi-times"
                                                 actionListener="#{dashboardSecretarBean.anuleazaEditareOrganizatie}"
                                                 process="@this" immediate="true"
                                                 update=":orgForm:organizatieOutputPanel"
                                                 styleClass="ui-button-secondary" style="margin-left: 5px;"/>
                            </div>
                        </p:outputPanel>
                    </p:outputPanel>
                </p:panel>
            </h:form>
            <br/>

            <h:form id="mainForm">
                <p:panel id="departmentManagementPanel" header="Management Departamente" toggleable="true" collapsed="false">
                    <p:commandButton value="Adaugă Departament Nou" icon="pi pi-plus"
                                     actionListener="#{dashboardSecretarBean.deschideDialogDepartamentNou}"
                                     update=":manageDepartmentForm"
                                     oncomplete="PF('manageDepartmentDialog').show()"
                                     styleClass="ui-button-outlined ui-button-success mb-3"/>

                    <p:dataTable id="departmentsTable" var="dept" value="#{dashboardSecretarBean.departmentList}" emptyMessage="Niciun departament definit." rows="5" paginator="true" paginatorPosition="bottom">
                        <p:column headerText="Nume Departament" sortBy="#{dept.nume}"><h:outputText value="#{dept.nume}"/></p:column>
                        <p:column headerText="Coordonator" sortBy="#{dept.coordonator.numeComplet}"><h:outputText value="#{dept.coordonator.numeComplet}" rendered="#{not empty dept.coordonator}"/><h:outputText value="-" rendered="#{empty dept.coordonator}"/></p:column>
                        <p:column headerText="Acțiuni" style="width:14rem; text-align: center">
                            <p:commandButton icon="pi pi-pencil" title="Editează"
                                             update=":manageDepartmentForm"
                                             oncomplete="PF('manageDepartmentDialog').show()"
                                             styleClass="ui-button-info rounded-button" style="margin-right: 5px;">
                                <f:setPropertyActionListener value="#{dept}" target="#{dashboardSecretarBean.selectedDepartament}"/>
                            </p:commandButton>
                            <p:commandButton icon="pi pi-trash" title="Șterge" actionListener="#{dashboardSecretarBean.stergeDepartament(dept)}" update=":mainForm:departmentManagementPanel :growl" styleClass="ui-button-danger rounded-button" style="margin-right: 5px;">
                                <p:confirm header="Confirmare" message="Ești sigur că vrei să ștergi departamentul '#{dept.nume}'?" icon="pi pi-exclamation-triangle"/>
                            </p:commandButton>
                            <p:commandButton icon="pi pi-file-pdf" title="Generează Raport PDF"
                                             actionListener="#{dashboardSecretarBean.genereazaSiTrimiteRaportDepartament(dept)}"
                                             update=":growl"
                                             styleClass="ui-button-help rounded-button"/>
                        </p:column>
                    </p:dataTable>
                </p:panel>
                <br/>

                <p:panel header="Prezențe Ședințe Generale" toggleable="true" collapsed="true">
                    <p:outputPanel id="attendancePanel">
                        <p:outputPanel rendered="#{!dashboardSecretarBean.attendanceMode}">
                            <p:commandButton value="Realizează Prezența Acum" icon="pi pi-check-square"
                                             actionListener="#{dashboardSecretarBean.initiazaFoaiePrezenta}"
                                             update=":mainForm:attendancePanel"
                                             styleClass="ui-button-success mb-3"/>
                            <p:dataTable var="sedinta" value="#{dashboardSecretarBean.istoricSedinte}" emptyMessage="Nu există istoric pentru ședințe." rows="5" paginator="true" paginatorPosition="bottom">
                                <f:facet name="header">Istoric Ședințe</f:facet>
                                <p:column headerText="Data Ședinței"><h:outputText value="#{sedinta.dataSedinta}"><f:convertDateTime pattern="dd.MM.yyyy HH:mm"/></h:outputText></p:column>
                                <p:column headerText="Descriere"><h:outputText value="#{sedinta.descriere}"/></p:column>
                            </p:dataTable>
                        </p:outputPanel>

                        <p:outputPanel rendered="#{dashboardSecretarBean.attendanceMode}">
                            <h4>Foaie de Prezență</h4>
                            <p:panelGrid columns="2" layout="grid" styleClass="ui-panelgrid-blank mb-3">
                                <p:outputLabel for="meetingDate" value="Data și Ora:" />
                                <p:calendar id="meetingDate" value="#{dashboardSecretarBean.sedintaCurenta.dataSedinta}" showTime="true" pattern="dd.MM.yyyy HH:mm" required="true"/>

                                <p:outputLabel for="meetingDesc" value="Descriere:" />
                                <p:inputText id="meetingDesc" value="#{dashboardSecretarBean.sedintaCurenta.descriere}" required="true" placeholder="Ex: Ședință Generală"/>
                            </p:panelGrid>

                            <p:dataTable var="prezenta" value="#{dashboardSecretarBean.listaPrezente}" editable="true">
                                <p:column headerText="Voluntar"><h:outputText value="#{prezenta.voluntar.numeComplet}"/></p:column>
                                <p:column headerText="Status Prezență" style="width:12rem;">
                                    <p:selectOneMenu value="#{prezenta.status}">
                                        <f:selectItems value="#{dashboardSecretarBean.statusPrezentaValues}" var="s" itemLabel="#{s}" itemValue="#{s}"/>
                                    </p:selectOneMenu>
                                </p:column>
                            </p:dataTable>

                            <div class="mt-3">
                                <p:commandButton value="Salvează Prezența" icon="pi pi-save"
                                                 actionListener="#{dashboardSecretarBean.salveazaFoaiePrezenta}"
                                                 update=":mainForm:attendancePanel :growl"/>
                                <p:commandButton value="Anulează" icon="pi pi-times"
                                                 actionListener="#{dashboardSecretarBean.anuleazaFoaiePrezenta}"
                                                 process="@this" immediate="true"
                                                 update=":mainForm:attendancePanel"
                                                 styleClass="ui-button-secondary" style="margin-left: 5px;"/>
                            </div>
                        </p:outputPanel>
                    </p:outputPanel>
                </p:panel>
                <br/>

                <p:panel header="Management Voluntari" toggleable="true" collapsed="true">
                </p:panel>
            </h:form>
        </div>

        <div id="footer">Corgi App &#169; 2025</div>
    </div>

    <p:dialog header="Gestionează Departament" widgetVar="manageDepartmentDialog" modal="true" responsive="true" width="500">
        <h:form id="manageDepartmentForm">
            <p:panelGrid columns="2" layout="grid" styleClass="ui-panelgrid-blank ui-fluid">
                <p:outputLabel for="deptName" value="Nume Departament:" />
                <p:inputText id="deptName" value="#{dashboardSecretarBean.selectedDepartament.nume}" required="true" />

                <p:outputLabel for="deptDesc" value="Descriere:" />
                <p:inputTextarea id="deptDesc" value="#{dashboardSecretarBean.selectedDepartament.descriere}" />

                <p:outputLabel for="deptCoord" value="Coordonator:" />
                <p:selectOneMenu id="deptCoord" value="#{dashboardSecretarBean.selectedDepartament.coordonator}" converter="omnifaces.SelectItemsConverter">
                    <f:selectItem itemLabel="Fără Coordonator" itemValue="#{null}" />
                    <f:selectItems value="#{dashboardSecretarBean.voluntariCoordonatori}" var="coord" itemLabel="#{coord.numeComplet}" itemValue="#{coord}" />
                </p:selectOneMenu>
            </p:panelGrid>

            <div class="mt-3 text-right">
                <p:commandButton value="Salvează"
                                 actionListener="#{dashboardSecretarBean.salveazaDepartament}"
                                 update=":mainForm:departmentManagementPanel :growl"
                                 oncomplete="if(!args.validationFailed){PF('manageDepartmentDialog').hide()}"/>
            </div>
        </h:form>
    </p:dialog>

    <p:confirmDialog global="true" showEffect="fade" hideEffect="fade" responsive="true" width="350">
        <p:commandButton value="Nu" type="button" styleClass="ui-confirmdialog-no ui-button-secondary"/>
        <p:commandButton value="Da" type="button" styleClass="ui-confirmdialog-yes"/>
    </p:confirmDialog>

</h:body>
</html>