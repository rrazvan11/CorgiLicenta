<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui">

<h:head>
    <title>Dashboard Secretar</title>
    <h:outputStylesheet library="default" name="style.css"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
</h:head>

<h:body>
    <div id="page-container">
        <p:growl id="growl" showDetail="true" life="4000" skipDetailIfEqualsSummary="true"/>

        <div id="top-bar">
            <div class="app-title">
                <i class="pi pi-briefcase" style="font-size: 1.5rem; margin-right: 10px;"></i>
                Dashboard Secretar
            </div>
            <div class="user-status">
                <h:form>
                    <span>Bun venit, #{dashboardSecretarBean.loggedInUser.username}!</span>
                    <p:commandButton value="Delogare" action="#{loginBean.doLogout}" icon="pi pi-sign-out" styleClass="ui-button-warning"/>
                </h:form>
            </div>
        </div>

        <div id="content">
            <h:form id="mainForm">
                <p:panel id="panelOrganizatie" header="Datele Organizației" toggleable="true">
                    <p:outputPanel id="organizatieOutputPanel">
                        <p:outputPanel rendered="#{!dashboardSecretarBean.editModeOrganizatie}">
                            <p:panelGrid columns="2" layout="grid" styleClass="ui-panelgrid-blank">
                                <h:outputText value="Nume Organizație:"/><h:outputText value="#{dashboardSecretarBean.currentOrganizatie.nume}" style="font-weight:bold;"/>
                                <h:outputText value="Cod Fiscal:"/><h:outputText value="#{dashboardSecretarBean.currentOrganizatie.cif}" style="font-weight:bold;"/>
                                <h:outputText value="Email Contact:"/><h:outputText value="#{dashboardSecretarBean.currentOrganizatie.mail}" style="font-weight:bold;"/>
                                <h:outputText value="Adresă Sediu:"/><h:outputText value="#{dashboardSecretarBean.currentOrganizatie.adresa}" style="font-weight:bold;"/>
                            </p:panelGrid>
                            <div class="mt-3">
                                <p:commandButton value="Editează Datele" icon="pi pi-pencil"
                                                 actionListener="#{dashboardSecretarBean.activeazaModEditareOrganizatie}"
                                                 update="mainForm:organizatieOutputPanel"/>
                            </div>
                        </p:outputPanel>

                        <p:outputPanel rendered="#{dashboardSecretarBean.editModeOrganizatie}">
                            <p:panelGrid columns="2" layout="grid" styleClass="ui-panelgrid-blank ui-fluid">
                                <h:outputText value="Nume Organizație:"/><h:outputText value="#{dashboardSecretarBean.currentOrganizatie.nume}" style="font-weight:bold;"/>
                                <h:outputText value="Cod Fiscal:"/><h:outputText value="#{dashboardSecretarBean.currentOrganizatie.cif}" style="font-weight:bold;"/>
                                <p:outputLabel for="orgMail" value="Email Contact:"/><p:inputText id="orgMail" value="#{dashboardSecretarBean.currentOrganizatie.mail}" required="true"/>
                                <p:outputLabel for="orgAddress" value="Adresă Sediu:"/><p:inputText id="orgAddress" value="#{dashboardSecretarBean.currentOrganizatie.adresa}" required="true"/>
                            </p:panelGrid>
                            <div class="mt-3">
                                <p:commandButton value="Salvează Modificări" icon="pi pi-save"
                                                 actionListener="#{dashboardSecretarBean.salveazaDetaliiOrganizatie}"
                                                 update="mainForm:organizatieOutputPanel growl"/>
                                <p:commandButton value="Anulează" icon="pi pi-times"
                                                 actionListener="#{dashboardSecretarBean.anuleazaEditareOrganizatie}"
                                                 process="@this"
                                                 update="mainForm:organizatieOutputPanel"
                                                 styleClass="ui-button-secondary" style="margin-left: 5px;"/>
                            </div>
                        </p:outputPanel>
                    </p:outputPanel>
                </p:panel>
                <br/>

                <p:panel id="departmentManagementPanel" header="Management Departamente" toggleable="true" collapsed="true">
                    <p:commandButton value="Adaugă Departament Nou" icon="pi pi-plus" actionListener="#{dashboardSecretarBean.deschideDialogDepartamentNou}" oncomplete="PF('manageDepartmentDialog').show()" update=":dialogsForm:manageDepartmentForm" styleClass="ui-button-outlined ui-button-success mb-3"/>

                    <p:dataTable id="departmentsTable" var="dept" value="#{dashboardSecretarBean.departmentList}" emptyMessage="Niciun departament definit." rows="5" paginator="true" paginatorPosition="bottom">
                        <p:column headerText="Nume Departament" sortBy="#{dept.nume}"><h:outputText value="#{dept.nume}"/></p:column>
                        <p:column headerText="Coordonator" sortBy="#{dept.coordonator.username}"><h:outputText value="#{dept.coordonator.username}" rendered="#{not empty dept.coordonator}"/><h:outputText value="-" rendered="#{empty dept.coordonator}"/></p:column>
                        <p:column style="width:10rem; text-align: center">
                            <p:commandButton icon="pi pi-pencil" title="Editează" oncomplete="PF('manageDepartmentDialog').show()" update=":dialogsForm:manageDepartmentForm" styleClass="ui-button-info rounded-button" style="margin-right: 5px;"><f:setPropertyActionListener value="#{dept}" target="#{dashboardSecretarBean.selectedDepartament}"/></p:commandButton>
                            <p:commandButton icon="pi pi-trash" title="Șterge" actionListener="#{dashboardSecretarBean.stergeDepartament(dept)}" update="mainForm:departmentManagementPanel growl" styleClass="ui-button-danger rounded-button"><p:confirm header="Confirmare" message="Ești sigur că vrei să ștergi departamentul '#{dept.nume}'?" icon="pi pi-exclamation-triangle"/></p:commandButton>
                        </p:column>
                    </p:dataTable>
                </p:panel>
                <br/>

                <p:panel header="Generare Rapoarte" toggleable="true" collapsed="true">
                    <p:outputPanel id="reportPanel">
                        <div class="ui-grid ui-fluid">
                            <div class="ui-g-12 ui-md-6" style="display: flex; align-items: center;">
                                <p:outputLabel value="Voluntar selectat:" style="font-weight: bold;"/>
                                <h:outputText value=" #{dashboardSecretarBean.selectedVolunteerForReports.nume} #{dashboardSecretarBean.selectedVolunteerForReports.prenume}" rendered="#{not empty dashboardSecretarBean.selectedVolunteerForReports}" style="margin-left:10px;"/>
                                <h:outputText value=" Niciun voluntar selectat" rendered="#{empty dashboardSecretarBean.selectedVolunteerForReports}" style="margin-left:10px; font-style:italic;"/>
                            </div>
                            <div class="ui-g-12 ui-md-3"><p:commandButton value="Trimite Certificat" icon="pi pi-file-pdf" action="#{dashboardSecretarBean.trimiteCertificatPeEmail}" update="growl" disabled="#{empty dashboardSecretarBean.selectedVolunteerForReports}"/></div>
                            <div class="ui-g-12 ui-md-3"><p:commandButton value="Trimite Raport Activitate" icon="pi pi-chart-bar" action="#{dashboardSecretarBean.trimiteRaportActivitatePeEmail}" update="growl" disabled="#{empty dashboardSecretarBean.selectedVolunteerForReports}"/></div>
                        </div>
                    </p:outputPanel>
                </p:panel>
                <br/>

                <p:panel header="Management Voluntari">
                    <p:toolbar><p:toolbarGroup><p:inputText value="#{dashboardSecretarBean.searchKeyword}" placeholder="Caută după nume, prenume, email..."/><p:commandButton value="Caută" action="#{dashboardSecretarBean.cautaVoluntari}" update="mainForm:volunteerTabs" icon="pi pi-search"/><p:commandButton value="Resetează" action="#{dashboardSecretarBean.incarcaDateleInitiale}" update="mainForm" icon="pi pi-refresh" styleClass="ui-button-outlined"/></p:toolbarGroup></p:toolbar>

                    <p:tabView id="volunteerTabs">
                        <p:tab title="Neasignați (#{dashboardSecretarBean.voluntariNeasignati.size()})">
                            <p:dataTable var="vol" value="#{dashboardSecretarBean.voluntariNeasignati}" emptyMessage="Nu există voluntari neasignați." paginator="true" paginatorPosition="bottom" rows="5" selectionMode="single" selection="#{dashboardSecretarBean.selectedVolunteerForReports}" rowKey="#{vol.id}">
                                <p:ajax event="rowSelect" update=":mainForm:reportPanel"/><p:ajax event="rowUnselect" update=":mainForm:reportPanel"/>
                                <p:column headerText="Nume și Prenume"><h:outputText value="#{vol.nume} #{vol.prenume}"/></p:column>
                                <p:column headerText="Email"><h:outputText value="#{vol.user.email}"/></p:column>
                                <p:column headerText="Asignează Departament">
                                    <p:selectOneMenu value="#{vol.departament}" converter="omnifaces.SelectItemsConverter" effect="fade" filter="true">
                                        <f:selectItem itemLabel="Selectează" itemValue="#{null}" noSelectionOption="true"/><f:selectItems value="#{dashboardSecretarBean.departmentList}" var="dept" itemLabel="#{dept.nume}" itemValue="#{dept}"/>
                                        <p:ajax listener="#{dashboardSecretarBean.laSchimbareaDepartamentului(vol)}" update="mainForm:volunteerTabs growl"/>
                                    </p:selectOneMenu>
                                </p:column>
                                <p:column headerText="Status">
                                    <p:selectOneMenu value="#{vol.status}">
                                        <f:selectItem itemLabel="Colaborator" itemValue="COLABORATOR"/>
                                        <f:selectItem itemLabel="Activ" itemValue="ACTIV"/>
                                        <p:ajax listener="#{dashboardSecretarBean.laSchimbareaStatusului(vol)}" update="mainForm:volunteerTabs growl"/>
                                    </p:selectOneMenu>
                                </p:column>
                                <p:column headerText="Acțiuni" style="text-align:center; width: 6rem;">
                                    <p:commandButton icon="pi pi-eye-slash" title="Dezactivează cont" actionListener="#{dashboardSecretarBean.comutaStareCont(vol)}" update="mainForm:volunteerTabs growl" styleClass="ui-button-danger rounded-button"/>
                                </p:column>
                            </p:dataTable>
                        </p:tab>

                        <p:tab title="Voluntari Activi (#{dashboardSecretarBean.voluntariActivi.size()})">
                            <p:dataTable var="vol" value="#{dashboardSecretarBean.voluntariActivi}" selectionMode="single" selection="#{dashboardSecretarBean.selectedVolunteerForReports}" rowKey="#{vol.id}" emptyMessage="Nu există voluntari activi." paginator="true" paginatorPosition="bottom" rows="10">
                                <p:ajax event="rowSelect" update=":mainForm:reportPanel"/><p:ajax event="rowUnselect" update=":mainForm:reportPanel"/>
                                <p:column headerText="Nume și Prenume" sortBy="#{vol.nume}"><h:outputText value="#{vol.nume} #{vol.prenume}"/></p:column>
                                <p:column headerText="Email"><h:outputText value="#{vol.user.email}"/></p:column>
                                <p:column headerText="Departament">
                                    <p:selectOneMenu value="#{vol.departament}" converter="omnifaces.SelectItemsConverter"><f:selectItems value="#{dashboardSecretarBean.departmentList}" var="dept" itemLabel="#{dept.nume}" itemValue="#{dept}"/><p:ajax listener="#{dashboardSecretarBean.laSchimbareaDepartamentului(vol)}" update="growl mainForm:volunteerTabs"/></p:selectOneMenu>
                                </p:column>
                                <p:column headerText="Rol">
                                    <p:selectOneMenu value="#{vol.user.rol}">
                                        <f:selectItem itemLabel="Voluntar" itemValue="VOLUNTAR"/>
                                        <f:selectItem itemLabel="Coordonator" itemValue="COORDONATOR"/>
                                        <p:ajax listener="#{dashboardSecretarBean.laSchimbareaRolului(vol)}" update="mainForm:volunteerTabs growl"/>
                                    </p:selectOneMenu>
                                </p:column>
                                <p:column headerText="Status">
                                    <p:selectOneMenu value="#{vol.status}">
                                        <f:selectItem itemLabel="Activ" itemValue="ACTIV"/><f:selectItem itemLabel="Colaborator" itemValue="COLABORATOR"/>
                                        <p:ajax listener="#{dashboardSecretarBean.laSchimbareaStatusului(vol)}" update="mainForm:volunteerTabs growl"/>
                                    </p:selectOneMenu>
                                </p:column>
                                <p:column headerText="Acțiuni" style="text-align:center; width: 6rem;">
                                    <p:commandButton icon="pi pi-eye-slash" title="Dezactivează cont" actionListener="#{dashboardSecretarBean.comutaStareCont(vol)}" update="mainForm:volunteerTabs growl" styleClass="ui-button-danger rounded-button"/>
                                </p:column>
                            </p:dataTable>
                        </p:tab>

                        <p:tab title="Colaboratori (#{dashboardSecretarBean.voluntariColaboratori.size()})">
                            <p:dataTable var="vol" value="#{dashboardSecretarBean.voluntariColaboratori}" selectionMode="single" selection="#{dashboardSecretarBean.selectedVolunteerForReports}" rowKey="#{vol.id}" emptyMessage="Nu există colaboratori." paginator="true" paginatorPosition="bottom" rows="10">
                                <p:ajax event="rowSelect" update=":mainForm:reportPanel"/><p:ajax event="rowUnselect" update=":mainForm:reportPanel"/>
                                <p:column headerText="Nume și Prenume" sortBy="#{vol.nume}"><h:outputText value="#{vol.nume} #{vol.prenume}"/></p:column>
                                <p:column headerText="Email"><h:outputText value="#{vol.user.email}"/></p:column>
                                <p:column headerText="Status">
                                    <p:selectOneMenu value="#{vol.status}">
                                        <f:selectItem itemLabel="Activ" itemValue="ACTIV"/><f:selectItem itemLabel="Colaborator" itemValue="COLABORATOR"/>
                                        <p:ajax listener="#{dashboardSecretarBean.laSchimbareaStatusului(vol)}" update="mainForm:volunteerTabs growl"/>
                                    </p:selectOneMenu>
                                </p:column>
                                <p:column headerText="Acțiuni" style="text-align:center; width: 6rem;">
                                    <p:commandButton icon="pi pi-eye-slash" title="Dezactivează cont" actionListener="#{dashboardSecretarBean.comutaStareCont(vol)}" update="mainForm:volunteerTabs growl" styleClass="ui-button-danger rounded-button"/>
                                </p:column>
                            </p:dataTable>
                        </p:tab>

                        <p:tab title="Coordonatori (#{dashboardSecretarBean.coordonatori.size()})">
                            <p:dataTable var="vol" value="#{dashboardSecretarBean.coordonatori}" selectionMode="single" selection="#{dashboardSecretarBean.selectedVolunteerForReports}" rowKey="#{vol.id}" emptyMessage="Nu există coordonatori." paginator="true" paginatorPosition="bottom" rows="10">
                                <p:ajax event="rowSelect" update=":mainForm:reportPanel"/><p:ajax event="rowUnselect" update=":mainForm:reportPanel"/>
                                <p:column headerText="Nume și Prenume" sortBy="#{vol.nume}"><h:outputText value="#{vol.nume} #{vol.prenume}"/></p:column>
                                <p:column headerText="Email"><h:outputText value="#{vol.user.email}"/></p:column>
                                <p:column headerText="Departament">
                                    <p:selectOneMenu value="#{vol.departament}" converter="omnifaces.SelectItemsConverter" effect="fade" filter="true" filterMatchMode="contains">
                                        <f:selectItem itemLabel="Selectează" itemValue="#{null}"/><f:selectItems value="#{dashboardSecretarBean.departmentList}" var="dept" itemLabel="#{dept.nume}" itemValue="#{dept}"/>
                                        <p:ajax listener="#{dashboardSecretarBean.laSchimbareaDepartamentului(vol)}" update="growl mainForm:volunteerTabs"/>
                                    </p:selectOneMenu>
                                </p:column>
                                <p:column headerText="Acțiuni" style="text-align:center; width: 6rem;">
                                    <p:commandButton icon="pi pi-eye-slash" title="Dezactivează cont" actionListener="#{dashboardSecretarBean.comutaStareCont(vol)}" update="mainForm:volunteerTabs growl" styleClass="ui-button-danger rounded-button"/>
                                </p:column>
                            </p:dataTable>
                        </p:tab>

                        <p:tab title="Inactivi (#{dashboardSecretarBean.voluntariInactivi.size()})">
                            <p:dataTable var="vol" value="#{dashboardSecretarBean.voluntariInactivi}" emptyMessage="Nu există voluntari inactivi." paginator="true" paginatorPosition="bottom" rows="10">
                                <p:column headerText="Nume și Prenume" sortBy="#{vol.nume}"><h:outputText value="#{vol.nume} #{vol.prenume}"/></p:column>
                                <p:column headerText="Email"><h:outputText value="#{vol.user.email}"/></p:column>
                                <p:column headerText="Acțiuni" style="text-align:center; width: 8rem;">
                                    <p:commandButton icon="pi pi-check" title="Reactivează Contul" actionListener="#{dashboardSecretarBean.comutaStareCont(vol)}" update="mainForm:volunteerTabs growl" styleClass="ui-button-success rounded-button"/>
                                </p:column>
                            </p:dataTable>
                        </p:tab>
                    </p:tabView>
                </p:panel>
            </h:form>
        </div>

        <div id="footer">Corgi App &#169; 2024</div>
    </div>

    <h:form id="dialogsForm">
        <p:dialog header="Detalii Departament" widgetVar="manageDepartmentDialog" modal="true" resizable="false" showEffect="fade" hideEffect="fade" width="500">
            <p:outputPanel id="manageDepartmentForm">
                <p:panelGrid columns="2" layout="grid" styleClass="ui-panelgrid-blank ui-fluid">
                    <p:outputLabel for="deptName" value="Nume:"/><p:inputText id="deptName" value="#{dashboardSecretarBean.selectedDepartament.nume}" required="true"/>
                    <p:outputLabel for="coordinator" value="Coordonator:"/><p:selectOneMenu id="coordinator" value="#{dashboardSecretarBean.selectedDepartament.coordonator}" converter="omnifaces.SelectItemsConverter" filter="true" filterMatchMode="contains">
                    <f:selectItem itemLabel="Fără coordonator" itemValue="#{null}" noSelectionOption="true"/><f:selectItems value="#{dashboardSecretarBean.potentialCoordinators}" var="coordUser" itemLabel="#{coordUser.username}" itemValue="#{coordUser}"/>
                </p:selectOneMenu>
                </p:panelGrid>
            </p:outputPanel>
            <f:facet name="footer">
                <p:commandButton value="Salvează" actionListener="#{dashboardSecretarBean.salveazaDepartament}" update="mainForm:departmentManagementPanel :mainForm:volunteerTabs growl" process="dialogsForm:manageDepartmentForm @this"/>
                <p:commandButton value="Anulează" oncomplete="PF('manageDepartmentDialog').hide()" styleClass="ui-button-secondary"/>
            </f:facet>
        </p:dialog>

        <p:confirmDialog global="true" showEffect="fade" hideEffect="fade" responsive="true" width="350">
            <p:commandButton value="Da" type="button" styleClass="ui-confirmdialog-yes" /><p:commandButton value="Nu" type="button" styleClass="ui-confirmdialog-no ui-button-secondary" />
        </p:confirmDialog>
    </h:form>
</h:body>
</html>